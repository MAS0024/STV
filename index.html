<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    
    <div class="container">
        <div class="main-video">
            <div class="video">

               <iframe id="reproductor" allow="autoplay; encrypted-media" 
                        allowfullscreen
                        sandbox="allow-same-origin allow-scripts allow-popups-to-escape-sandbox">
                </iframe>


                <h3 class="title">Selecciona un canal</h3>
            </div>
            <div class="alternative-sources">
                <label for="sourceSelect">Servidor:</label>
                <select id="sourceSelect"></select>
                <button id="changeSourceBtn">Recargar</button>
            </div>
        </div>

        
        <div class="video-list">
            <input type="text" id="search" placeholder="Buscar canal..." class="search-bar">
            <div class="vid" data-title="TV Publica" data-sources='["https://rk2.nebunexa.com/cvatt.php?get=Q2FuYWw3&lang=1",
                                                                    "https://streamtp.live/global1.php?stream=tv_publica"]'>
                <img src="img/TVP.png" alt="TV Publica" class="logo">
                <h3 class="title">TV Publica</h3>
            </div>
            <div class="vid" data-title="Telefe" data-sources='["https://rk2.nebunexa.com/cvatt.php?get=VGVsZWZlSEQ=&lang=1"]'>
                <img src="img/telefe.png" alt="Telefe" class="logo">
                <h3 class="title">Telefe</h3> 
            </div>
            <div class="vid" data-title="Espn Premium"  data-sources='["https://rk2.nebunexa.com/cvatt.php?get=Rm94X1Nwb3J0c19QcmVtaXVuX0hE&lang=1",
                                                                       "https://streamtp.live/global1.php?stream=espn_premium"]'>
                <img src="img/ESPNPremium.png" alt="Espn Premium" class="logo">
                <h3 class="title">Espn Premium</h3> 
            </div>
            <div class="vid" data-title="MTV 00s" data-sources='["https://rk2.nebunexa.com/cvatt.php?get=TVRWMDA=&lang=1"]'>              
                <img src="img/MTV00s.webp" alt="MTV 00s" class="logo">
                <h3 class="title">MTV 00s</h3> 
            </div>
            <div class="vid" data-title="ESPN" data-sources='["https://rk2.nebunexa.com/cvatt.php?get=RVNQTjJIRA&lang=1",
                                                              "https://streamtp.live/global1.php?stream=espn1"]'>                
                <img src="img/ESPN.png" alt="ESPN" class="logo">
                <h3 class="title">ESPN</h3> 
            </div>
         </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    let mainVideo = document.querySelector('.main-video iframe'); // Mantenemos la referencia del iframe original
    const listVideo = document.querySelectorAll('.video-list .vid');
    const title = document.querySelector('.main-video .title');
    const sourceSelect = document.getElementById('sourceSelect');
    const changeSourceBtn = document.getElementById('changeSourceBtn');
    const searchBar = document.getElementById('search');
    
    listVideo.forEach(video => {
        video.addEventListener('click', () => {
            listVideo.forEach(vid => vid.classList.remove('active'));
            video.classList.add('active');
            const sources = JSON.parse(video.dataset.sources);
            
            // Actualizamos las opciones del select y cambiamos el iframe autom치ticamente
            updateSourceOptions(sources);
            changeIframeSource(sources[0]); // Cambiamos la fuente y aplicamos sandbox si es necesario
            title.textContent = video.querySelector('.title').textContent;
        });
    });

    changeSourceBtn.addEventListener('click', () => {
        const selectedSource = sourceSelect.value;
        changeIframeSource(selectedSource);
    });

    function updateSourceOptions(sources) {
        sourceSelect.innerHTML = '';
        sources.forEach((source, index) => {
            const option = document.createElement('option');
            option.value = source;
            option.textContent = `Fuente ${index + 1}`;
            sourceSelect.appendChild(option);
        });
    }

    function changeIframeSource(source) {
        const selectedSourceIndex = Array.from(sourceSelect.options).findIndex(option => option.value === source);
        
        // Creamos un nuevo iframe para cambiar la fuente
        const newIframe = document.createElement('iframe');
        newIframe.id = 'reproductor';
        newIframe.src = source;
        newIframe.allow = 'autoplay; encrypted-media';
        newIframe.allowFullscreen = true;

        if (selectedSourceIndex !== 1) { // Aplica el sandbox para cualquier opci칩n que no sea la opci칩n 2
            newIframe.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-popups-to-escape-sandbox');
        }

        // Reemplazamos el iframe manteniendo la referencia correcta
        mainVideo.parentNode.replaceChild(newIframe, mainVideo);
        mainVideo = newIframe; // Actualizamos la referencia de mainVideo
    }
    
    searchBar.addEventListener('input', () => {
        const filter = searchBar.value.toLowerCase();
        listVideo.forEach(video => {
            const title = video.getAttribute('data-title').toLowerCase();
            video.style.display = title.includes(filter) ? '' : 'none';
        });
    });

    // BLOQUEO DE POP-UPS
    function bloquearPopups() {
        window.open = function() {
            console.log("Intento de abrir un pop-up bloqueado.");
            return null;
        };

        document.querySelectorAll('a[target="_blank"]').forEach(function(link) {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                console.log("Intento de abrir un enlace en nueva pesta침a bloqueado.");
            });
        });
    }

    bloquearPopups();
});

    </script>
</body>
</html>